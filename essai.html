<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>.huser6666666. Bonjour Christilla. .allons-y.</title>
<style>
body {
  background: #000;
  color: #eee;
  font-family: 'Courier New', monospace;
  text-align: center;
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}
h1 {
  color: #941F06;
  letter-spacing: 2px;
  font-size: 1.5em;
  margin-bottom: 20px;
}
#arrow {
  width: 120px;
  height: 120px;
  transition: transform 0.1s linear;
  filter: drop-shadow(0 0 10px #941F06);
}
#status {
  margin-top: 20px;
  font-size: 1.1em;
  color: #fff;
}
.tap {
  position: fixed;
  bottom: 15px;
  font-size: 0.9em;
  color: #fff;
  opacity: 0.8;
}
</style>
</head>
<body>
<h1>.huser6666666. Bonjour Christilla. .allons-y.</h1>
<div id="arrow">
  <svg viewBox="0 0 24 24" width="120" height="120" fill="#941F06">
    <path d="M12 2L4 10h5v10h6V10h5L12 2z"/>
  </svg>
</div>
<div id="status">activation du GPS...</div>
<div class="tap">(tape l茅cran pour activer le GPS et la boussole)</div>

<script>
const target = { lat: 49.033094, lon: 2.077448 };

//  Tes sons ici
const sound100 = "https://www.chosic.com/wp-content/uploads/2023/06/heartbeat-soundsmith-1(chosic.com).mp3";
const sound50  = "https://www.chosic.com/wp-content/uploads/2023/06/heartbeat-soundsmith(chosic.com).mp3";
const horror20 = "https://www.chosic.com/wp-content/uploads/2022/10/its-in-the-fog(chosic.com).mp3";

let audioCtx;
let buffers = {};
let currentSource = null;
let currentZone = "none";
let currentPos = null;
let currentHeading = 0;

// --- utilitaires g茅o ---
function toRad(d){return d*Math.PI/180;}
function toDeg(r){return r*180/Math.PI;}
function distance(lat1,lon1,lat2,lon2){
  const R=6371e3;
  const 1=toRad(lat1), 2=toRad(lat2);
  const =toRad(lat2-lat1), 位=toRad(lon2-lon1);
  const a=Math.sin(/2)**2 + Math.cos(1)*Math.cos(2)*Math.sin(位/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}
function bearing(lat1,lon1,lat2,lon2){
  const 1=toRad(lat1), 2=toRad(lat2);
  const 位=toRad(lon2-lon1);
  const y=Math.sin(位)*Math.cos(2);
  const x=Math.cos(1)*Math.sin(2)-Math.sin(1)*Math.cos(2)*Math.cos(位);
  return (toDeg(Math.atan2(y,x))+360)%360;
}

// --- audio ---
async function loadSound(url){
  const resp = await fetch(url);
  const buf = await resp.arrayBuffer();
  return await audioCtx.decodeAudioData(buf);
}

function playBuffer(buf, loop=false, vol=1.0){
  stopCurrent();
  const src = audioCtx.createBufferSource();
  src.buffer = buf;
  src.loop = loop;
  const gain = audioCtx.createGain();
  gain.gain.value = vol;
  src.connect(gain).connect(audioCtx.destination);
  src.start(0);
  currentSource = src;
}

function stopCurrent(){
  if(currentSource){
    try{ currentSource.stop(); }catch(e){}
    currentSource = null;
  }
}

function switchZone(zone){
  if(zone === currentZone) return;
  currentZone = zone;
  stopCurrent();

  if(zone === "100" && buffers.b100) playBuffer(buffers.b100, true, 0.7);
  else if(zone === "50" && buffers.b50) playBuffer(buffers.b50, true, 0.9);
  else if(zone === "20" && buffers.horror) playBuffer(buffers.horror, false, 1);
}

// --- orientation / gps ---
function handleOrientation(e){
  if(e.absolute || e.webkitCompassHeading){
    currentHeading = e.webkitCompassHeading || 360 - e.alpha;
  }
  updateArrow();
}
function handlePosition(pos){
  currentPos = pos.coords;
  updateArrow();
}

function updateArrow(){
  if(!currentPos) return;
  const dist = distance(currentPos.latitude, currentPos.longitude, target.lat, target.lon);
  const bear = bearing(currentPos.latitude, currentPos.longitude, target.lat, target.lon);
  const angle = (bear - currentHeading + 360)%360;
  document.getElementById('arrow').style.transform=`rotate(${angle}deg)`;

  const status=document.getElementById('status');
  if(dist>100){ status.textContent=`.encore ${Math.round(dist)} m猫tres...`; switchZone("none"); }
  else if(dist>50){ status.textContent=".tu t'approches..."; switchZone("100"); }
  else if(dist>20){ status.textContent=".je sens ton souffle..."; switchZone("50"); }
  else { status.textContent=".regarde autour de toi... la croix t'attend."; switchZone("20"); }
}

// --- init ---
async function init(){
  document.querySelector('.tap').style.display='none';

  // Cr茅e un contexte audio d茅verrouill茅
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const dummy = audioCtx.createOscillator();
  dummy.connect(audioCtx.destination);
  dummy.start();
  dummy.stop();

  // Pr茅charge les sons
  buffers.b100 = await loadSound(sound100);
  buffers.b50  = await loadSound(sound50);
  buffers.horror = await loadSound(horror20);

  // active la boussole
  if(window.DeviceOrientationEvent && typeof DeviceOrientationEvent.requestPermission==='function'){
    DeviceOrientationEvent.requestPermission().then(state=>{
      if(state==='granted') window.addEventListener('deviceorientation',handleOrientation,true);
      else alert("Autorise la boussole pour jouer !");
    });
  }else window.addEventListener('deviceorientation',handleOrientation,true);

  // active le GPS
  navigator.geolocation.watchPosition(handlePosition, e=>{
    document.getElementById('status').textContent="GPS indisponible...";
  }, {enableHighAccuracy:true});
}

document.body.addEventListener('click', init, {once:true});
</script>
</body>
</html>
