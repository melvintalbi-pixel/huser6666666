<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Labyrinthe — Hardcore 25×25</title>
<style>
:root{
  --bg:#050304; --wall:#0b0705; --floor:#2b2218; --player:#f6e6b2;
  --trap:#7b1420; --exit:#0b6b33; --text:#efe6c9; --accent:#b98a26;
}
*{box-sizing:border-box;}
html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,system-ui,Arial;color:var(--text);}
#boardWrap{width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;overflow:hidden;}
#grid{display:grid;grid-template-columns:repeat(25,20px);grid-template-rows:repeat(25,20px);gap:2px;}
.cell{width:20px;height:20px;border-radius:3px;}
.wall{background:var(--wall);}
.empty{background:var(--floor);}
.player{background:linear-gradient(180deg,var(--player),#d4af37);box-shadow:0 1px 3px rgba(0,0,0,0.6);}
.trap{background:var(--trap);}
.exit{background:linear-gradient(180deg,#0b6b33,#045c2b);}
.modal-back{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);align-items:center;justify-content:center;z-index:200;}
.modal{background:linear-gradient(180deg,#22160f,#0f0b08);padding:18px;border-radius:10px;border:2px solid rgba(185,138,38,0.18);width:360px;color:var(--text);text-align:center;}
.ctl{padding:10px;border-radius:8px;background:#241b15;color:var(--text);text-align:center;cursor:pointer;border:1px solid rgba(255,255,255,0.02);margin:4px;}
</style>
</head>
<body>
<div id="boardWrap">
  <div id="grid"></div>
</div>

<div class="modal-back" id="modalBackdrop">
  <div class="modal" id="modal"></div>
</div>

<script>
const ROWS=25,COLS=25;
const gridEl=document.getElementById('grid');
const modalBackdrop=document.getElementById('modalBackdrop');
const modal=document.getElementById('modal');

let grid=[];
let player={r:1,c:1};
let trapPassed=false;

// Initialisation grille (tout mur)
for(let r=0;r<ROWS;r++){
  grid[r]=[];
  for(let c=0;c<COLS;c++){
    grid[r][c]={type:'wall'};
  }
}

// Génération labyrinthe simple mais correct
function carveMaze(){
  for(let r=1;r<ROWS-1;r++){
    for(let c=1;c<COLS-1;c++){
      if(r%2===1 && c%2===1) grid[r][c].type='empty';
    }
  }
  // Création de chemins aléatoires horizontaux/verticaux
  for(let r=1;r<ROWS-1;r+=2){
    for(let c=1;c<COLS-1;c+=2){
      const dirs=[[0,1],[1,0]];
      const [dr,dc]=dirs[Math.floor(Math.random()*2)];
      const nr=r+dr,nc=c+dc;
      if(nr<ROWS-1 && nc<COLS-1) grid[nr][nc].type='empty';
    }
  }
  // Trap obligatoire
  grid[ROWS-3][1].type='trap';
  // Sortie
  grid[ROWS-2][COLS-2].type='exit';
}
carveMaze();

// Affichage
function render(){
  gridEl.innerHTML='';
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const div=document.createElement('div');
      div.className='cell';
      const t=grid[r][c].type;
      if(r===player.r && c===player.c) div.classList.add('player');
      else div.classList.add(t);
      gridEl.appendChild(div);
    }
  }
}
render();

// Déplacements uniquement H/V
function canMove(r,c){return r>=0 && r<ROWS && c>=0 && c<COLS && (grid[r][c].type!=='wall');}
function move(dr,dc){
  const nr=player.r+dr,nc=player.c+dc;
  if(canMove(nr,nc)){
    player.r=nr; player.c=nc;
    render();
    checkCell();
  }
}

// Détection case spéciale
function checkCell(){
  const t=grid[player.r][player.c].type;
  if(t==='trap' && !trapPassed) handleTrap();
  if(t==='exit' && trapPassed){
    showModal('<h2>Bravo !</h2><p>Tu as atteint la sortie !</p>');
  }
}

// Trap obligatoire avec calcul complexe et popups IA
function handleTrap(){
  showModal(`<h2>Piège obligatoire</h2><p>Résous ce calcul pour continuer :</p>
  <p style="font-weight:bold;">Math.round(Math.sin(1.5707963267948966)*1e7 + Math.cos(0)*1e6 - 4333334)</p>
  <input id="ans" placeholder="Réponse" style="padding:6px;border-radius:4px;margin-top:6px;"><br>
  <button id="check" class="ctl">Valider</button>`);
  
  setTimeout(()=>{
    document.getElementById('check').addEventListener('click',()=>{
      const val=Number(document.getElementById('ans').value);
      if(val===6666666){
        hideModal();
        // Popup IA
        showModal(`<h2>Bravo !</h2><p>As-tu utilisé l'IA ?</p>
        <button id="yesAI" class="ctl">Oui</button>
        <button id="noAI" class="ctl">Non</button>`);
        setTimeout(()=>{
          document.getElementById('yesAI').addEventListener('click',()=>{trapPassed=true;hideModal();render();});
          document.getElementById('noAI').addEventListener('click',()=>{
            hideModal();
            showModal(`<h2>En plus tu mens !</h2>
            <button id="confess" class="ctl">oui j'avoue</button>
            <button id="lie" class="ctl">J'ai menti je suis une sous merde</button>`);
            setTimeout(()=>{
              document.getElementById('confess').addEventListener('click',()=>{trapPassed=true;hideModal();render();});
              document.getElementById('lie').addEventListener('click',()=>{trapPassed=true;hideModal();render();});
            },50);
          });
        },50);
      } else { alert('Mauvaise réponse !'); player={r:1,c:1};render(); hideModal();}
    });
  },50);
}

// Contrôles clavier
window.addEventListener('keydown',e=>{
  switch(e.key){
    case 'ArrowUp': move(-1,0); break;
    case 'ArrowDown': move(1,0); break;
    case 'ArrowLeft': move(0,-1); break;
    case 'ArrowRight': move(0,1); break;
    case 'w': move(-1,0); break;
    case 's': move(1,0); break;
    case 'a': move(0,-1); break;
    case 'd': move(0,1); break;
  }
});

// Modals
function showModal(html){ modal.innerHTML=html; modalBackdrop.style.display='flex'; }
function hideModal(){ modalBackdrop.style.display='none'; }
</script>
</body>
</html>
