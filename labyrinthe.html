<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>Labyrinthe Hardcore PC - Trap Math Obligatoire</title>
<style>
:root{
  --bg:#050304;
  --wall:#0b0705;
  --floor:#2b2218;
  --player:#f6e6b2;
  --trap:#7b1420;
  --exit:#0b6b33;
  --text:#efe6c9;
  --accent:#b98a26;
}
html,body{margin:0;padding:0;height:100%;overflow:hidden;background:var(--bg);font-family:sans-serif;color:var(--text);}
#grid{display:grid;grid-template-columns:repeat(30,30px);grid-template-rows:repeat(30,30px);gap:2px;width:100vw;height:100vh;}
.cell{width:30px;height:30px;border-radius:3px;}
.wall{background:var(--wall);}
.empty{background:var(--floor);}
.player{background:var(--player);box-shadow:0 0 8px #d4af37;}
.trap{background:var(--trap);}
.exit{background:var(--exit);}
#modalBackdrop{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);justify-content:center;align-items:center;z-index:200;}
#modal{background:linear-gradient(180deg,#22160f,#0f0b08);padding:18px;border-radius:10px;border:2px solid rgba(185,138,38,0.18);width:400px;color:var(--text);text-align:center;}
#modal h2{color:var(--accent);}
#modal input{padding:8px;border-radius:6px;border:1px solid #333;margin-top:10px;width:80%;text-align:center;}
#modal button{margin-top:12px;padding:8px 12px;border-radius:6px;border:none;background:var(--accent);color:#000;cursor:pointer;}
</style>
</head>
<body>
<div id="grid"></div>
<div id="modalBackdrop"><div id="modal"></div></div>
<script>
// Configuration
const ROWS = 30, COLS = 30;
const gridEl = document.getElementById('grid');
const modalBackdrop = document.getElementById('modalBackdrop');
const modal = document.getElementById('modal');

let maze=[], player={r:0,c:0}, trapDone=false;

// Génération labyrinthe plus dur (DFS)
function initMaze(){
  maze = Array.from({length:ROWS},()=>Array(COLS).fill('wall'));
  const stack=[[0,0]];
  maze[0][0]='empty';
  while(stack.length){
    const [r,c]=stack.pop();
    let dirs=[[0,1],[1,0],[0,-1],[-1,0]];
    dirs.sort(()=>Math.random()-0.5);
    for(const [dr,dc] of dirs){
      const nr=r+dr*2, nc=c+dc*2;
      if(nr>=0 && nc>=0 && nr<ROWS && nc<COLS && maze[nr][nc]==='wall'){
        maze[r+dr][c+dc]='empty';
        maze[nr][nc]='empty';
        stack.push([nr,nc]);
      }
    }
  }
  // piège obligatoire au centre
  maze[Math.floor(ROWS/2)][Math.floor(COLS/2)]='trap';
  // sortie
  maze[ROWS-1][COLS-1]='exit';
  // joueur
  player={r:0,c:0};
}

function renderMaze(){
  gridEl.innerHTML='';
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const div=document.createElement('div');
      div.classList.add('cell',maze[r][c]);
      if(r===player.r && c===player.c) div.classList.add('player');
      gridEl.appendChild(div);
    }
  }
}

function showTrapPuzzle(){
  const expr = "Math.round(Math.sin(1.5707963267948966)*1e7 + Math.cos(0)*1e6 - 4333334)";
  const result = eval(expr);
  modal.innerHTML=`
    <h2>Piège Mathématique Obligatoire</h2>
    <p>Résous le calcul pour continuer :</p>
    <pre>${expr}</pre>
    <input id="trapInput" placeholder="?" />
    <br/><button id="trapBtn">Valider</button>
  `;
  modalBackdrop.style.display='flex';
  document.getElementById('trapBtn').onclick=()=>{
    const val=parseInt(document.getElementById('trapInput').value.trim());
    if(val===result){
      trapDone=true;
      modalBackdrop.style.display='none';
      renderMaze();
    } else {
      alert("Erreur ! Retente !");
    }
  };
}

function showExit(){
  modal.innerHTML=`
    <h2>Félicitations !</h2>
    <p>Le mot de passe est : ENVOIE UN MESSAGE PRIVE A HUSER6666666 QUI CERTIFIE SUR L'HONNEUR QUE TU NE DONNERAS CETTE SOLUTION A PERSONNE ET IL TE DONNERA LE MOT DE PASSE</p>
    <button onclick="window.location.reload()">Recommencer</button>
  `;
  modalBackdrop.style.display='flex';
}

function move(dr,dc){
  const nr=player.r+dr;
  const nc=player.c+dc;
  if(nr<0||nc<0||nr>=ROWS||nc>=COLS) return;
  const type=maze[nr][nc];
  // Si on tente de sortir avant le trap, on bloque
  if(type==='exit' && !trapDone){
    alert("Tu dois d'abord résoudre le piège au centre !");
    return;
  }
  if(type==='trap' && !trapDone){
    showTrapPuzzle();
    return;
  }
  if(type==='wall') return;
  player.r=nr;
  player.c=nc;
  renderMaze();
  if(type==='exit') showExit();
}

window.addEventListener('keydown',e=>{
  switch(e.key.toLowerCase()){
    case 'z': case 'arrowup': move(-1,0); break;
    case 's': case 'arrowdown': move(1,0); break;
    case 'q': case 'arrowleft': move(0,-1); break;
    case 'd': case 'arrowright': move(0,1); break;
  }
});

initMaze();
renderMaze();
</script>
</body>
</html>
