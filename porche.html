<!-- frontend.html -->
<!doctype html>
<html lang="fr">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>huser chat</title>
<style>/* (style minimal, same as before) */:root{--bg:#070607;--accent:#941F06}html,body{height:100%;margin:0;font-family:system-ui;background:var(--bg);color:#eee} .wrap{max-width:800px;margin:0 auto;display:flex;flex-direction:column;height:100vh} header{padding:14px;text-align:center;color:var(--accent)} #chat{flex:1;overflow:auto;padding:14px;display:flex;flex-direction:column;gap:10px} .msg{max-width:75%;padding:12px;border-radius:10px} .bot{background:rgba(148,31,6,0.06);align-self:flex-start} .user{background:rgba(255,255,255,0.03);align-self:flex-end} footer{display:flex;gap:8px;padding:12px} input{flex:1;padding:12px;border-radius:8px;background:transparent;color:#fff;border:1px solid rgba(255,255,255,0.06)} button{padding:10px 12px;background:var(--accent);border:none;color:#fff;border-radius:8px}</style>
</head>
<body>
  <div class="wrap">
    <header>.huser6666666 — parle-lui</header>
    <div id="chat"><div class="msg bot">.un souffle froid traverse la pièce. qui ose réveiller la nuit ?</div><div class="msg bot">.donne un nom de personnage fictif et coche la case pour confirmer.</div></div>
    <div style="padding:8px 14px;color:#bbb">ne partage pas d'informations réelles.</div>
    <div style="display:flex;align-items:center;gap:8px;padding:8px 14px;color:#bbb"><input type="checkbox" id="confirmFict"/><label for="confirmFict">je confirme que le nom est fictif</label></div>
    <footer><input id="input" placeholder="nom du personnage..." /><button id="send">envoyer</button></footer>
  </div>

<script>
const chat=document.getElementById('chat'), input=document.getElementById('input'), send=document.getElementById('send'), cbox=document.getElementById('confirmFict');

function addMsg(txt,who='bot'){const d=document.createElement('div');d.className='msg '+(who==='bot'?'bot':'user'); if(who==='bot'){ if(!txt.startsWith('.')) txt='.'+txt; txt=txt.toLowerCase(); } d.textContent=txt; chat.appendChild(d); chat.scrollTop=chat.scrollHeight; }

send.addEventListener('click', async ()=>{
  const v=input.value.trim(); if(!v) return;
  addMsg(v,'user');
  if(!cbox.checked){ addMsg("tu dois cocher la case confirmant que le nom est fictif.", 'bot'); input.value=''; return; }
  try{
    const res=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:v,confirmFict:true})});
    const j=await res.json();
    if(j.reply) addMsg(j.reply,'bot');
    if(j.redirect){
      const d=document.createElement('div'); d.className='msg bot'; d.innerHTML = '.voici l\\'indice : <a href="'+j.redirect+'" target="_blank">regarder la vidéo</a>'; chat.appendChild(d); chat.scrollTop=chat.scrollHeight;
    }
  }catch(e){
    addMsg('.erreur: impossible de joindre le serveur.','bot');
  }
  input.value='';
});
</script>
</body>
</html>
