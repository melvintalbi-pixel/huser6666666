<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>huser6666666 - √âtape 3</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #000;
      color: #eee;
      font-family: 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      transition: background 0.3s ease;
    }

    h1 {
      color: #941F06;
      font-size: clamp(1.3em, 4vw, 2em);
      text-shadow: 0 0 10px #500;
      margin-bottom: 10px;
      transition: color 0.3s ease, text-shadow 0.3s ease;
    }

    p {
      max-width: 85%;
      color: #ccc;
      font-size: clamp(1em, 3.5vw, 1.2em);
      margin-bottom: 25px;
      transition: opacity 0.3s ease;
    }

    #startBtn {
      background: none;
      border: 1px solid #941F06;
      color: #941F06;
      padding: 12px 25px;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.2s ease;
      letter-spacing: 1px;
    }

    #startBtn:hover {
      background: #941F06;
      color: #fff;
    }

    #heard {
      margin-top: 25px;
      font-size: 1em;
      color: #aaa;
      opacity: 0.8;
      max-width: 80%;
    }

    #result {
      display: none;
      margin-top: 40px;
      color: #fff;
      font-size: 1.3em;
      text-shadow: 0 0 15px #f00;
      animation: flicker 0.25s alternate infinite;
    }

    @keyframes flicker {
      from { opacity: 0.7; }
      to { opacity: 1; }
    }

    @keyframes shake {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(-2px, 1px); }
      50% { transform: translate(2px, -2px); }
      75% { transform: translate(-1px, 2px); }
    }

    .shake {
      animation: shake 0.3s infinite;
    }
  </style>
</head>
<body>
  <h1>.huser6666666</h1>
  <p>Il nahaaaasssssss profond√©ment...<br>Dis la phrase compl√®te, √† voix haute, pour l‚Äôinvoquer. il cache se secret dans sa boisson pr√©fer√©... hic</p>

  <button id="startBtn">Commencer l‚Äôincantation de ses morts</button>
  <div id="heard"></div>
  <div id="result">.il s‚Äôest r√©veill√©. bien jou√©.<br>Le prochain QR t‚Äôattend sous le Porche</div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const heard = document.getElementById('heard');
    const result = document.getElementById('result');
    const body = document.body;
    const h1 = document.querySelector('h1');

    // Phrase rituelle √† reconna√Ætre
    const targetPhrase = "la nuit tombe il est temps de hanter les ames des gens present ce soir a cormeille";

    // Normalisation texte : minuscules, sans accents
    function normalize(str) {
      return str
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .replace(/[.,!?]/g, "")
        .trim();
    }

    startBtn.addEventListener('click', () => {
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        alert("‚ö†Ô∏è Ton navigateur ne supporte pas la reconnaissance vocale.");
        return;
      }

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      recognition.lang = "fr-FR";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      startBtn.style.display = "none";
      heard.textContent = "üéôÔ∏è Parle maintenant...";
      heard.style.opacity = 1;

      recognition.start();

      recognition.onresult = (event) => {
        const transcript = normalize(event.results[0][0].transcript);
        heard.textContent = "Tu as dit : " + transcript;
        console.log("Reconnu :", transcript);

        // Distance de similarit√© (simple ratio de mots reconnus)
        const correctWords = normalize(targetPhrase).split(" ");
        const spokenWords = transcript.split(" ");
        let matches = 0;
        for (let word of spokenWords) {
          if (correctWords.includes(word)) matches++;
        }
        const accuracy = matches / correctWords.length;

        if (accuracy > 0.7) {
          // Succ√®s
          heard.style.color = "#0f0";
          body.style.background = "#400";
          h1.classList.add("shake");
          setTimeout(() => {
            h1.classList.remove("shake");
            result.style.display = "block";
            body.style.background = "#300";
          }, 1500);
          heard.textContent += " ‚úÖ";
        } else {
          // √âchec
          heard.style.color = "#f00";
          heard.textContent += " ‚ùå Mauvaise invocation.";
          setTimeout(() => {
            startBtn.style.display = "block";
            heard.style.color = "#aaa";
          }, 2000);
        }
      };

      recognition.onerror = (event) => {
        heard.textContent = "Erreur : " + event.error;
        startBtn.style.display = "block";
      };

      recognition.onend = () => {
        if (result.style.display === "none" && heard.style.color !== "#0f0") {
          startBtn.style.display = "block";
        }
      };
    });
  </script>
</body>
</html>
